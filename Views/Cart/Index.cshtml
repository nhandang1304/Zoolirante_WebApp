@model Zoolirante_Open_Minded.ViewModels.CartVM
@{
    ViewData["Title"] = "Your Cart";
}
<h2>Your Cart</h2>

@if (!Model.Items.Any())
{
    <div class="alert alert-info">Your cart is empty.</div>
}
else
{
    <div class="d-flex justify-content-between mb-3">
        <form asp-action="Clear" method="post">
            @Html.AntiForgeryToken()
            <button class="btn btn-outline-danger btn-sm">Clear cart</button>
        </form>

        <a class="btn btn-success" asp-action="Checkout">Checkout</a>
    </div>


    <table class="table table-sm align-middle">
        <thead>
            <tr><th>Item</th><th class="text-end">Price</th><th style="width:140px">Qty</th><th class="text-end">Total</th><th></th></tr>
        </thead>
        <tbody>
            @foreach (var it in Model.Items)
            {
                <tr>
                    <td>
                        <div class="d-flex align-items-center gap-2">
                            @if (!string.IsNullOrWhiteSpace(it.ImageUrl))
                            {
                                <img src="@it.ImageUrl" alt="@it.Name" style="width:48px;height:48px;object-fit:cover;border-radius:8px;" />
                            }
                            <div>@it.Name</div>
                        </div>
                    </td>
                    <td class="text-end">
                        @it.Price.ToString("C")
                        @if (it.OriginalPrice > it.Price)
                        {
                            <div><s>@it.OriginalPrice.ToString("C")</s></div>
                            <div class="text-success">Saved @it.LineSavings.ToString("C")</div>
                        }
                    </td>
                    <td>
                        <form asp-action="Update" method="post" class="d-flex gap-2">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="productId" value="@it.ProductId" />
                            <input type="number" name="qty" value="@it.Qty" min="0" class="form-control form-control-sm" />
                            <button class="btn btn-sm btn-outline-primary">Update</button>
                        </form>
                    </td>
                    <td class="text-end">@it.LineTotal.ToString("C")</td>
                    <td>
                        <form asp-action="Remove" method="post">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="productId" value="@it.ProductId" />
                            <button class="btn btn-sm btn-outline-danger">Remove</button>
                        </form>
                    </td>
                </tr>
            }
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-end">Subtotal</th>
                <th class="text-end">@Model.Subtotal.ToString("C")</th>
                <th></th>
            </tr>
            @if (Model.TotalSavings > 0)
            {
                <tr>
                    <th colspan="3" class="text-end text-success">You saved</th>
                    <th class="text-end text-success">-@Model.TotalSavings.ToString("C")</th>
                    <th></th>
                </tr>
            }
        </tfoot>
    </table>
}

